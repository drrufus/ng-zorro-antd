!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/cdk/overlay"),require("@angular/common"),require("@angular/core"),require("@angular/forms"),require("ng-zorro-antd/icon"),require("rxjs"),require("@angular/cdk/keycodes"),require("@angular/cdk/portal"),require("ng-zorro-antd/core")):"function"==typeof define&&define.amd?define("ng-zorro-antd/mention",["exports","@angular/cdk/overlay","@angular/common","@angular/core","@angular/forms","ng-zorro-antd/icon","rxjs","@angular/cdk/keycodes","@angular/cdk/portal","ng-zorro-antd/core"],t):t(((e=e||self)["ng-zorro-antd"]=e["ng-zorro-antd"]||{},e["ng-zorro-antd"].mention={}),e.ng.cdk.overlay,e.ng.common,e.ng.core,e.ng.forms,e["ng-zorro-antd"].icon,e.rxjs,e.ng.cdk.keycodes,e.ng.cdk.portal,e["ng-zorro-antd"].core)}(this,(function(e,t,n,i,o,r,s,a,c,l){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function g(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,o,r=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function p(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(g(arguments[t]));return e}
/**
     * @license
     * Copyright Alibaba.com All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE
     */
var h=function(){function e(){}return e.ɵfac=function(t){return new(t||e)},e.ɵdir=i.ɵɵdefineDirective({type:e,selectors:[["","nzMentionSuggestion",""]],exportAs:["nzMentionSuggestion"]}),e}(),f=function(){function e(){this.triggerChange$=new s.Subject}return e.prototype.triggerChanged=function(){return this.triggerChange$.asObservable()},e.prototype.registerTrigger=function(e){this.trigger!==e&&(this.trigger=e,this.triggerChange$.next(e))},e.prototype.ngOnDestroy=function(){this.triggerChange$.complete()},e.ɵfac=function(t){return new(t||e)},e.ɵprov=i.ɵɵdefineInjectable({token:e,factory:e.ɵfac}),e}(),d=["autocomplete","off"],v={provide:o.NG_VALUE_ACCESSOR,useExisting:i.forwardRef((function(){return m})),multi:!0},m=function(){function e(e,t){this.el=e,this.nzMentionService=t,this.onFocusin=new i.EventEmitter,this.onBlur=new i.EventEmitter,this.onInput=new i.EventEmitter,this.onKeydown=new i.EventEmitter,this.onClick=new i.EventEmitter}return e.prototype.completeEvents=function(){this.onFocusin.complete(),this.onBlur.complete(),this.onInput.complete(),this.onKeydown.complete(),this.onClick.complete()},e.prototype.focus=function(e){this.el.nativeElement.focus(),this.el.nativeElement.setSelectionRange(e,e)},e.prototype.insertMention=function(e){var t=this.el.nativeElement.value,n=e.mention.trim()+" ",i=[t.slice(0,e.startPos+1),n,t.slice(e.endPos,t.length)].join("");this.el.nativeElement.value=i,this.focus(e.startPos+n.length+1),this.onChange(i),this.value=i},e.prototype.writeValue=function(e){this.value=e,this.el.nativeElement.value="string"==typeof e?e:""},e.prototype.registerOnChange=function(e){this.onChange=e},e.prototype.registerOnTouched=function(e){this.onTouched=e},e.prototype.ngAfterViewInit=function(){this.nzMentionService.registerTrigger(this)},e.prototype.ngOnDestroy=function(){this.completeEvents()},e.ɵfac=function(t){return new(t||e)(i.ɵɵdirectiveInject(i.ElementRef),i.ɵɵdirectiveInject(f))},e.ɵdir=i.ɵɵdefineDirective({type:e,selectors:[["input","nzMentionTrigger",""],["textarea","nzMentionTrigger",""]],hostBindings:function(e,t,n){1&e&&(i.ɵɵlistener("focusin",(function(e){return t.onFocusin.emit()}))("blur",(function(e){return t.onBlur.emit()}))("input",(function(e){return t.onInput.emit(e)}))("keydown",(function(e){return t.onKeydown.emit(e)}))("click",(function(e){return t.onClick.emit(e)})),i.ɵɵelementHostAttrs(d))},exportAs:["nzMentionTrigger"],features:[i.ɵɵProvidersFeature([v])]}),e}();function y(e,t){1&e&&i.ɵɵelementContainer(0)}var O=function(e){return{$implicit:e}};function C(e,t){if(1&e&&(i.ɵɵelementContainerStart(0),i.ɵɵtemplate(1,y,1,0,"ng-container",7),i.ɵɵelementContainerEnd()),2&e){var n=i.ɵɵnextContext().$implicit,o=i.ɵɵnextContext(2);i.ɵɵadvance(1),i.ɵɵproperty("ngTemplateOutlet",o.suggestionTemplate)("ngTemplateOutletContext",i.ɵɵpureFunction1(2,O,n))}}function w(e,t){if(1&e&&i.ɵɵtext(0),2&e){var n=i.ɵɵnextContext().$implicit,o=i.ɵɵnextContext(2);i.ɵɵtextInterpolate(o.nzValueWith(n))}}function z(e,t){if(1&e){var n=i.ɵɵgetCurrentView();i.ɵɵelementStart(0,"li",4),i.ɵɵlistener("mousedown",(function(e){return i.ɵɵrestoreView(n),e.preventDefault()}))("click",(function(e){i.ɵɵrestoreView(n);var o=t.$implicit;return i.ɵɵnextContext(2).selectSuggestion(o)})),i.ɵɵtemplate(1,C,2,4,"ng-container",5),i.ɵɵtemplate(2,w,1,1,"ng-template",null,6,i.ɵɵtemplateRefExtractor),i.ɵɵelementEnd()}if(2&e){var o=t.index,r=i.ɵɵreference(3),s=i.ɵɵnextContext(2);i.ɵɵclassProp("focus",o===s.activeIndex),i.ɵɵadvance(1),i.ɵɵproperty("ngIf",s.suggestionTemplate)("ngIfElse",r)}}function x(e,t){1&e&&(i.ɵɵelementStart(0,"span"),i.ɵɵelement(1,"i",10),i.ɵɵelementEnd())}function S(e,t){if(1&e&&(i.ɵɵelementStart(0,"span"),i.ɵɵtext(1),i.ɵɵelementEnd()),2&e){var n=i.ɵɵnextContext(3);i.ɵɵadvance(1),i.ɵɵtextInterpolate(n.nzNotFoundContent)}}function E(e,t){if(1&e&&(i.ɵɵelementStart(0,"li",8),i.ɵɵtemplate(1,x,2,0,"span",9),i.ɵɵtemplate(2,S,2,1,"span",9),i.ɵɵelementEnd()),2&e){var n=i.ɵɵnextContext(2);i.ɵɵadvance(1),i.ɵɵproperty("ngIf",n.nzLoading),i.ɵɵadvance(1),i.ɵɵproperty("ngIf",!n.nzLoading)}}function I(e,t){if(1&e&&(i.ɵɵelementStart(0,"ul",1),i.ɵɵtemplate(1,z,4,3,"li",2),i.ɵɵtemplate(2,E,3,2,"li",3),i.ɵɵelementEnd()),2&e){var n=i.ɵɵnextContext();i.ɵɵadvance(1),i.ɵɵproperty("ngForOf",n.filteredSuggestions),i.ɵɵadvance(1),i.ɵɵproperty("ngIf",0===n.filteredSuggestions.length)}}var M=["*"],b=function(){function e(e,t,n,o,r){this.ngDocument=e,this.changeDetectorRef=t,this.overlay=n,this.viewContainerRef=o,this.nzMentionService=r,this.nzValueWith=function(e){return e},this.nzPrefix="@",this.nzLoading=!1,this.nzNotFoundContent="无匹配结果，轻敲空格完成输入",this.nzPlacement="bottom",this.nzSuggestions=[],this.nzOnSelect=new i.EventEmitter,this.nzOnSearchChange=new i.EventEmitter,this.isOpen=!1,this.filteredSuggestions=[],this.suggestionTemplate=null,this.activeIndex=-1,this.previousValue=null}return Object.defineProperty(e.prototype,"suggestionChild",{set:function(e){e&&(this.suggestionTemplate=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"triggerNativeElement",{get:function(){return this.trigger.el.nativeElement},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var e=this;this.nzMentionService.triggerChanged().subscribe((function(t){e.trigger=t,e.bindTriggerEvents(),e.closeDropdown(),e.overlayRef=null}))},e.prototype.ngOnChanges=function(e){e.hasOwnProperty("nzSuggestions")&&this.isOpen&&(this.previousValue=null,this.activeIndex=-1,this.resetDropdown(!1))},e.prototype.ngOnDestroy=function(){this.closeDropdown()},e.prototype.closeDropdown=function(){this.overlayRef&&this.overlayRef.hasAttached()&&(this.overlayRef.detach(),this.overlayBackdropClickSubscription.unsubscribe(),this.isOpen=!1,this.changeDetectorRef.markForCheck())},e.prototype.openDropdown=function(){this.attachOverlay(),this.isOpen=!0,this.changeDetectorRef.markForCheck()},e.prototype.getMentions=function(){return this.trigger?l.getMentions(this.trigger.value,this.nzPrefix):[]},e.prototype.selectSuggestion=function(e){var t=this.nzValueWith(e);this.trigger.insertMention({mention:t,startPos:this.cursorMentionStart,endPos:this.cursorMentionEnd}),this.nzOnSelect.emit(e),this.closeDropdown(),this.activeIndex=-1},e.prototype.handleInput=function(e){var t=e.target;this.trigger.onChange(t.value),this.trigger.value=t.value,this.resetDropdown()},e.prototype.handleKeydown=function(e){var t=e.keyCode;if(this.isOpen&&t===a.ENTER&&-1!==this.activeIndex&&this.filteredSuggestions.length)this.selectSuggestion(this.filteredSuggestions[this.activeIndex]),e.preventDefault();else if(t===a.LEFT_ARROW||t===a.RIGHT_ARROW)this.resetDropdown(),e.stopPropagation();else{if(this.isOpen&&(t===a.TAB||t===a.ESCAPE))return void this.closeDropdown();this.isOpen&&t===a.UP_ARROW&&(this.setPreviousItemActive(),e.preventDefault(),e.stopPropagation()),this.isOpen&&t===a.DOWN_ARROW&&(this.setNextItemActive(),e.preventDefault(),e.stopPropagation())}},e.prototype.handleClick=function(){this.resetDropdown()},e.prototype.bindTriggerEvents=function(){var e=this;this.trigger.onInput.subscribe((function(t){return e.handleInput(t)})),this.trigger.onKeydown.subscribe((function(t){return e.handleKeydown(t)})),this.trigger.onClick.subscribe((function(){return e.handleClick()}))},e.prototype.suggestionsFilter=function(e,t){var n=this,i=e.substring(1);if(this.previousValue!==e){this.previousValue=e,t&&this.nzOnSearchChange.emit({value:this.cursorMention.substring(1),prefix:this.cursorMention[0]});var o=i.toLowerCase();this.filteredSuggestions=this.nzSuggestions.filter((function(e){return n.nzValueWith(e).toLowerCase().includes(o)}))}},e.prototype.resetDropdown=function(e){if(void 0===e&&(e=!0),this.resetCursorMention(),"string"==typeof this.cursorMention&&this.canOpen()){this.suggestionsFilter(this.cursorMention,e);var t=this.filteredSuggestions.indexOf(this.cursorMention.substring(1));this.activeIndex=t>=0?t:0,this.openDropdown()}else this.closeDropdown()},e.prototype.setNextItemActive=function(){this.activeIndex=this.activeIndex+1<=this.filteredSuggestions.length-1?this.activeIndex+1:0,this.changeDetectorRef.markForCheck()},e.prototype.setPreviousItemActive=function(){this.activeIndex=this.activeIndex-1<0?this.filteredSuggestions.length-1:this.activeIndex-1,this.changeDetectorRef.markForCheck()},e.prototype.canOpen=function(){var e=this.triggerNativeElement;return!e.readOnly&&!e.disabled},e.prototype.resetCursorMention=function(){for(var e=this.triggerNativeElement.value.replace(/[\r\n]/g," ")||"",t=this.triggerNativeElement.selectionStart,n="string"==typeof this.nzPrefix?[this.nzPrefix]:this.nzPrefix,i=n.length;i>=0;){var o=e.lastIndexOf(n[i],t),r=e.indexOf(" ",t)>-1?e.indexOf(" ",t):e.length,s=e.substring(o,r);if(!(o>0&&" "!==e[o-1]||o<0||s.includes(n[i],1)||s.includes(" ")))return this.cursorMention=s,this.cursorMentionStart=o,void(this.cursorMentionEnd=r);this.cursorMention=null,this.cursorMentionStart=-1,this.cursorMentionEnd=-1,i--}},e.prototype.updatePositions=function(){var e=l.getCaretCoordinates(this.triggerNativeElement,this.cursorMentionStart),t=e.top-this.triggerNativeElement.getBoundingClientRect().height-this.triggerNativeElement.scrollTop+("bottom"===this.nzPlacement?e.height-6:-6),n=e.left-this.triggerNativeElement.scrollLeft;this.positionStrategy.withDefaultOffsetX(n).withDefaultOffsetY(t),"bottom"===this.nzPlacement&&this.positionStrategy.withPositions(p(l.DEFAULT_MENTION_BOTTOM_POSITIONS)),"top"===this.nzPlacement&&this.positionStrategy.withPositions(p(l.DEFAULT_MENTION_TOP_POSITIONS)),this.positionStrategy.apply()},e.prototype.subscribeOverlayBackdropClick=function(){var e=this;return s.merge(s.fromEvent(this.ngDocument,"click"),s.fromEvent(this.ngDocument,"touchend")).subscribe((function(t){var n=t.target;e.isOpen&&n!==e.trigger.el.nativeElement&&e.overlayRef&&!e.overlayRef.overlayElement.contains(n)&&e.closeDropdown()}))},e.prototype.attachOverlay=function(){this.overlayRef||(this.portal=new c.TemplatePortal(this.suggestionsTemp,this.viewContainerRef),this.overlayRef=this.overlay.create(this.getOverlayConfig())),this.overlayRef&&!this.overlayRef.hasAttached()&&(this.overlayRef.attach(this.portal),this.overlayBackdropClickSubscription=this.subscribeOverlayBackdropClick()),this.updatePositions()},e.prototype.getOverlayConfig=function(){return new t.OverlayConfig({positionStrategy:this.getOverlayPosition(),scrollStrategy:this.overlay.scrollStrategies.reposition()})},e.prototype.getOverlayPosition=function(){var e=[new t.ConnectionPositionPair({originX:"start",originY:"bottom"},{overlayX:"start",overlayY:"top"}),new t.ConnectionPositionPair({originX:"start",originY:"top"},{overlayX:"start",overlayY:"bottom"})];return this.positionStrategy=this.overlay.position().flexibleConnectedTo(this.trigger.el).withPositions(e).withFlexibleDimensions(!1).withPush(!1),this.positionStrategy},e.ɵfac=function(o){return new(o||e)(i.ɵɵdirectiveInject(n.DOCUMENT,8),i.ɵɵdirectiveInject(i.ChangeDetectorRef),i.ɵɵdirectiveInject(t.Overlay),i.ɵɵdirectiveInject(i.ViewContainerRef),i.ɵɵdirectiveInject(f))},e.ɵcmp=i.ɵɵdefineComponent({type:e,selectors:[["nz-mention"]],contentQueries:function(e,t,n){var o;(1&e&&i.ɵɵcontentQuery(n,h,!0,i.TemplateRef),2&e)&&(i.ɵɵqueryRefresh(o=i.ɵɵloadQuery())&&(t.suggestionChild=o.first))},viewQuery:function(e,t){var n;(1&e&&i.ɵɵviewQuery(i.TemplateRef,!0),2&e)&&(i.ɵɵqueryRefresh(n=i.ɵɵloadQuery())&&(t.suggestionsTemp=n.first))},inputs:{nzValueWith:"nzValueWith",nzPrefix:"nzPrefix",nzLoading:"nzLoading",nzNotFoundContent:"nzNotFoundContent",nzPlacement:"nzPlacement",nzSuggestions:"nzSuggestions"},outputs:{nzOnSelect:"nzOnSelect",nzOnSearchChange:"nzOnSearchChange"},exportAs:["nzMention"],features:[i.ɵɵProvidersFeature([f]),i.ɵɵNgOnChangesFeature()],ngContentSelectors:M,decls:3,vars:0,consts:[["suggestions",""],[1,"ant-mention-dropdown"],["class","ant-mention-dropdown-item",3,"focus","mousedown","click",4,"ngFor","ngForOf"],["class","ant-mention-dropdown-notfound ant-mention-dropdown-item",4,"ngIf"],[1,"ant-mention-dropdown-item",3,"mousedown","click"],[4,"ngIf","ngIfElse"],["defaultSuggestion",""],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"ant-mention-dropdown-notfound","ant-mention-dropdown-item"],[4,"ngIf"],["nz-icon","","nzType","loading"]],template:function(e,t){1&e&&(i.ɵɵprojectionDef(),i.ɵɵprojection(0),i.ɵɵtemplate(1,I,3,2,"ng-template",null,0,i.ɵɵtemplateRefExtractor))},directives:[n.NgForOf,n.NgIf,n.NgTemplateOutlet,r.NzIconDirective],styles:[".ant-mention-dropdown[_ngcontent-%COMP%] {\n        top: 100%;\n        left: 0;\n        position: relative;\n        width: 100%;\n        margin-top: 4px;\n        margin-bottom: 4px;\n      }"],changeDetection:0}),function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);r>3&&s&&Object.defineProperty(t,n,s)}([l.InputBoolean(),u("design:type",Object)],e.prototype,"nzLoading",void 0),e}(),P=function(){function e(){}return e.ɵmod=i.ɵɵdefineNgModule({type:e}),e.ɵinj=i.ɵɵdefineInjector({factory:function(t){return new(t||e)},imports:[[n.CommonModule,o.FormsModule,t.OverlayModule,r.NzIconModule]]}),e}();("undefined"==typeof ngJitMode||ngJitMode)&&i.ɵɵsetNgModuleScope(P,{declarations:[b,m,h],imports:[n.CommonModule,o.FormsModule,t.OverlayModule,r.NzIconModule],exports:[b,m,h]}),e.NZ_MENTION_TRIGGER_ACCESSOR=v,e.NzMentionComponent=b,e.NzMentionModule=P,e.NzMentionService=f,e.NzMentionSuggestionDirective=h,e.NzMentionTriggerDirective=m,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ng-zorro-antd-mention.umd.min.js.map